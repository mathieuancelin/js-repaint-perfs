(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.diff=f()}})(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(_dereq_,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.upgrade=upgrade;var components=exports.components={};function upgrade(tagName,element){var CustomElement=components[tagName];if(!CustomElement||element instanceof CustomElement){return false}element.__proto__=Object.create(CustomElement.prototype);if(CustomElement.prototype.createdCallback){CustomElement.prototype.createdCallback.call(element)}return true}},{}],2:[function(_dereq_,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=get;var _make=_dereq_("../node/make");var _make2=_interopRequireDefault(_make);var _make3=_dereq_("../element/make");var _make4=_interopRequireDefault(_make3);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function get(descriptor){var uuid=descriptor.uuid;var element=(0,_make4.default)(descriptor);return{uuid:uuid,element:element}}},{"../element/make":3,"../node/make":6}],3:[function(_dereq_,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=make;var _svg=_dereq_("../svg");var svg=_interopRequireWildcard(_svg);var _make=_dereq_("../node/make");var _make2=_interopRequireDefault(_make);var _custom=_dereq_("./custom");var _entities=_dereq_("../util/entities");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function make(descriptor){var element=null;var isSvg=false;var CustomElement=_custom.components[descriptor.nodeName];if(_make2.default.nodes[descriptor.uuid]){return _make2.default.nodes[descriptor.uuid]}if(descriptor.nodeName==="#text"){element=document.createTextNode(descriptor.nodeValue)}else{if(svg.elements.indexOf(descriptor.nodeName)>-1){isSvg=true;element=document.createElementNS(svg.namespace,descriptor.nodeName)}else{element=document.createElement(descriptor.nodeName)}if(descriptor.attributes&&descriptor.attributes.length){for(var i=0;i<descriptor.attributes.length;i++){var attribute=descriptor.attributes[i];element.setAttribute(attribute.name,attribute.value)}}if(descriptor.childNodes&&descriptor.childNodes.length){for(var i=0;i<descriptor.childNodes.length;i++){element.appendChild(make(descriptor.childNodes[i]))}}}if(descriptor.nodeValue){element.textContent=(0,_entities.decodeEntities)(descriptor.nodeValue)}(0,_custom.upgrade)(descriptor.nodeName,element);if(CustomElement&&CustomElement.prototype.createdCallback){CustomElement.prototype.createdCallback.call(element)}_make2.default.nodes[descriptor.uuid]=element;return element}},{"../node/make":6,"../svg":12,"../util/entities":14,"./custom":1}],4:[function(_dereq_,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var missingStackTrace="Browser doesn't support error stack traces.";var TransitionStateError=exports.TransitionStateError=function(_Error){_inherits(TransitionStateError,_Error);function TransitionStateError(message){var _this;_classCallCheck(this,TransitionStateError);var error=(_this=_possibleConstructorReturn(this,Object.getPrototypeOf(TransitionStateError).call(this)),_this);_this.message=message;_this.stack=error.stack||missingStackTrace;return _this}return TransitionStateError}(Error);var DOMException=exports.DOMException=function(_Error2){_inherits(DOMException,_Error2);function DOMException(message){var _this2;_classCallCheck(this,DOMException);var error=(_this2=_possibleConstructorReturn(this,Object.getPrototypeOf(DOMException).call(this)),_this2);_this2.message="Uncaught DOMException: "+message;_this2.stack=error.stack||missingStackTrace;return _this2}return DOMException}(Error)},{}],5:[function(_dereq_,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.DOMException=exports.TransitionStateError=undefined;var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol?"symbol":typeof obj};var _errors=_dereq_("./errors");Object.defineProperty(exports,"TransitionStateError",{enumerable:true,get:function get(){return _errors.TransitionStateError}});Object.defineProperty(exports,"DOMException",{enumerable:true,get:function get(){return _errors.DOMException}});exports.outerHTML=outerHTML;exports.innerHTML=innerHTML;exports.element=element;exports.release=release;exports.registerElement=registerElement;exports.addTransitionState=addTransitionState;exports.removeTransitionState=removeTransitionState;exports.enableProllyfill=enableProllyfill;var _patch=_dereq_("./node/patch");var _patch2=_interopRequireDefault(_patch);var _release=_dereq_("./node/release");var _release2=_interopRequireDefault(_release);var _transitions=_dereq_("./transitions");var _custom=_dereq_("./element/custom");var _tree=_dereq_("./node/tree");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function outerHTML(element){var markup=arguments.length<=1||arguments[1]===undefined?"":arguments[1];var options=arguments.length<=2||arguments[2]===undefined?{}:arguments[2];options.inner=false;(0,_patch2.default)(element,markup,options)}function innerHTML(element){var markup=arguments.length<=1||arguments[1]===undefined?"":arguments[1];var options=arguments.length<=2||arguments[2]===undefined?{}:arguments[2];options.inner=true;(0,_patch2.default)(element,markup,options)}function element(element,newElement){var options=arguments.length<=2||arguments[2]===undefined?{}:arguments[2];(0,_patch2.default)(element,newElement,options)}function release(element){(0,_release2.default)(element)}var realRegisterElement=document.registerElement;function registerElement(tagName,constructor){var normalizedConstructor=constructor.prototype?constructor:null;if(!normalizedConstructor){constructor.__proto__=HTMLElement.prototype;normalizedConstructor=function NormalizedConstructor(){};normalizedConstructor.prototype=constructor}if(realRegisterElement){return realRegisterElement.call(document,tagName,normalizedConstructor)}if(tagName in _custom.components){throw new _errors.DOMException("\n      Failed to execute 'registerElement' on 'Document': Registration failed\n      for type '"+tagName+"'. A type with that name is already registered.\n    ")}_custom.components[tagName]=normalizedConstructor}function addTransitionState(state,callback){if(!state){throw new _errors.TransitionStateError("Missing transition state name")}if(!callback){throw new _errors.TransitionStateError("Missing transition state callback")}if(Object.keys(_transitions.states).indexOf(state)===-1){throw new _errors.TransitionStateError("Invalid state name: "+state)}_transitions.states[state].push(callback)}function removeTransitionState(state,callback){if(!callback&&state){_transitions.states[state].length=0}else if(state&&callback){if(Object.keys(_transitions.states).indexOf(state)===-1){throw new _errors.TransitionStateError("Invalid state name "+state)}var index=_transitions.states[state].indexOf(callback);_transitions.states[state].splice(index,1)}else{for(var _state in _transitions.states){_transitions.states[_state].length=0}}}function enableProllyfill(){Object.defineProperty(window,"TransitionStateError",{configurable:true,value:_errors.TransitionStateError});Object.defineProperty(document,"addTransitionState",{configurable:true,value:function value(state,callback){addTransitionState(state,callback)}});Object.defineProperty(document,"removeTransitionState",{configurable:true,value:function value(state,callback){removeTransitionState(state,callback)}});Object.defineProperty(Element.prototype,"diffInnerHTML",{configurable:true,set:function set(newHTML){innerHTML(this,newHTML)}});Object.defineProperty(Element.prototype,"diffOuterHTML",{configurable:true,set:function set(newHTML){outerHTML(this,newHTML)}});Object.defineProperty(Element.prototype,"diffElement",{configurable:true,value:function value(newElement,options){element(this,newElement,options)}});Object.defineProperty(Element.prototype,"diffRelease",{configurable:true,value:function value(newElement){(0,_release2.default)(this)}});if(!realRegisterElement){Object.defineProperty(document,"registerElement",{configurable:true,value:function value(tagName,component){registerElement(tagName,component)}})}if((typeof Element==="undefined"?"undefined":_typeof(Element))==="object"||(typeof HTMLElement==="undefined"?"undefined":_typeof(HTMLElement))==="object"){var realHTMLElement=HTMLElement||Element;if(!realHTMLElement.__proto__){var copy={set:function set(val){val=Object.keys(val).length?val:Object.getPrototypeOf(val);for(var key in val){if(val.hasOwnProperty(key)){this[key]=val[key]}}}};Object.defineProperty(realHTMLElement,"__proto__",copy);Object.defineProperty(realHTMLElement.prototype,"__proto__",copy)}HTMLElement=function HTMLElement(){};HTMLElement.prototype=Object.create(realHTMLElement.prototype);HTMLElement.__proto__=realHTMLElement;Element=HTMLElement}var activateComponents=function activateComponents(){var documentElement=document.documentElement;var bufferSet=false;_tree.TreeCache.forEach(function iterateTreeCache(elementMeta,element){if(elementMeta.isRendering){bufferSet=true}});if(bufferSet){return window.removeEventListener("load",activateComponents)}documentElement.addEventListener("renderComplete",function render(){var elementMeta=_tree.TreeCache.get(documentElement)||{};if(!elementMeta.isRendering){documentElement.diffRelease(documentElement)}documentElement.removeEventListener("renderComplete",render)});documentElement.diffOuterHTML=documentElement.outerHTML;window.removeEventListener("load",activateComponents)};if(document.readyState==="complete"){activateComponents()}else{window.addEventListener("load",activateComponents)}}},{"./element/custom":1,"./errors":4,"./node/patch":7,"./node/release":8,"./node/tree":10,"./transitions":13}],6:[function(_dereq_,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=make;var _pools2=_dereq_("../util/pools");var _custom=_dereq_("../element/custom");var pools=_pools2.pools;var empty={};make.nodes={};function make(node){var nodeType="nodeType"in node?node.nodeType:1;if(nodeType===2||nodeType===4||nodeType===8){return false}var entry=pools.elementObject.get();make.nodes[entry.uuid]=node;entry.nodeName=node.nodeName.toLowerCase();entry.nodeType=node.nodeType;if(nodeType===3){entry.nodeValue=node.textContent}entry.childNodes.length=0;entry.attributes.length=0;var attributes=node.attributes;if(attributes){var attributesLength=attributes.length;if(attributesLength){for(var i=0;i<attributesLength;i++){var attr=pools.attributeObject.get();attr.name=attributes[i].name;attr.value=attributes[i].value;entry.attributes[entry.attributes.length]=attr}}}var childNodes=node.childNodes?node.childNodes:[];var childNodesLength=childNodes.length;if(entry.nodeType!==3&&childNodesLength){for(var i=0;i<childNodesLength;i++){var newNode=make(childNodes[i]);if(newNode){entry.childNodes[entry.childNodes.length]=newNode}}}if(entry.nodeName==="html"){entry.childNodes=entry.childNodes.filter(function(el){return el.nodeName==="head"||el.nodeName==="body"})}if(_custom.components[entry.nodeName]){if((0,_custom.upgrade)(entry.nodeName,node)){if(node.parentNode&&node.attachedCallback){node.attachedCallback()}}}return entry}},{"../element/custom":1,"../util/pools":17}],7:[function(_dereq_,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=patchNode;var _create=_dereq_("../worker/create");var _memory=_dereq_("../util/memory");var _parser=_dereq_("../util/parser");var _render=_dereq_("../util/render");var _make=_dereq_("./make");var _make2=_interopRequireDefault(_make);var _process=_dereq_("../patches/process");var _process2=_interopRequireDefault(_process);var _sync=_dereq_("./sync");var _sync2=_interopRequireDefault(_sync);var _tree=_dereq_("./tree");var _pools=_dereq_("../util/pools");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function patchNode(element,newHTML,options){if(typeof options.enableWorker!=="boolean"){options.enableWorker=document.ENABLE_WORKER}var elementMeta=_tree.TreeCache.get(element)||{};elementMeta.options=options;_tree.TreeCache.set(element,elementMeta);var bufferSet=false;var isInner=options.inner;var previousMarkup=elementMeta.previousMarkup;_tree.TreeCache.forEach(function iterateTreeCache(_elementMeta,_element){if(_elementMeta.isRendering){elementMeta.renderBuffer={element:element,newHTML:newHTML,options:options};bufferSet=true}});if(bufferSet){return}var sameInnerHTML=isInner?previousMarkup===element.innerHTML:true;var sameOuterHTML=!isInner?previousMarkup===element.outerHTML:true;var sameTextContent=elementMeta._textContent===element.textContent;if(elementMeta.newHTML===newHTML){return}elementMeta.newHTML=newHTML;var worker=null;if(options.enableWorker&&_create.hasWorker){worker=elementMeta.worker=elementMeta.worker||(0,_create.create)()}var rebuildTree=function rebuildTree(){var oldTree=elementMeta.oldTree;if(oldTree){(0,_memory.unprotectElement)(oldTree,_make2.default);(0,_memory.cleanMemory)(_make2.default)}elementMeta.oldTree=(0,_memory.protectElement)((0,_make2.default)(element));elementMeta.updateWorkerTree=true};if(elementMeta.renderedViaWorker===true&&!options.enableWorker){rebuildTree()}if(!sameInnerHTML||!sameOuterHTML||!sameTextContent){rebuildTree()}if(options.enableWorker&&_create.hasWorker&&worker){elementMeta.isRendering=true;elementMeta.renderedViaWorker=true;elementMeta.workerCache=elementMeta.workerCache||[];var transferObject={};if(!elementMeta.hasWorkerRendered||elementMeta.updateWorkerTree){transferObject.oldTree=elementMeta.oldTree;elementMeta.updateWorkerTree=false}worker.onmessage=function onmessage(ev){var wrapRender=function wrapRender(cb){return function(){elementMeta.hasWorkerRendered=true;cb()}};var invokeRender=wrapRender((0,_render.completeRender)(element,elementMeta));var promises=(0,_process2.default)(element,ev.data.patches);if(promises.length){Promise.all(promises).then(invokeRender,function(ex){return console.log(ex)})}else{invokeRender()}};if(typeof newHTML!=="string"){transferObject.newTree=(0,_make2.default)(newHTML);worker.postMessage(transferObject);return}transferObject.newHTML=newHTML;transferObject.isInner=options.inner;worker.postMessage(transferObject)}else{if(elementMeta.renderedViaWorker&&elementMeta.oldTree){rebuildTree()}if(elementMeta.workerCache){elementMeta.workerCache.forEach(function(x){return(0,_memory.unprotectElement)(x,_make2.default)});delete elementMeta.workerCache}elementMeta.isRendering=true;elementMeta.updateWorkerTree=true;var newTree=null;if(typeof newHTML==="string"){newTree=(0,_parser.parseHTML)(newHTML,options.inner)}else{newTree=(0,_make2.default)(newHTML)}if(options.inner){var childNodes=Array.isArray(newTree)?newTree:[newTree];newTree={childNodes:childNodes,attributes:elementMeta.oldTree.attributes,uuid:elementMeta.oldTree.uuid,nodeName:elementMeta.oldTree.nodeName,nodeValue:elementMeta.oldTree.nodeValue}}var patches=(0,_sync2.default)(elementMeta.oldTree,newTree);var invokeRender=(0,_render.completeRender)(element,elementMeta);var promises=(0,_process2.default)(element,patches);if(promises.length){Promise.all(promises).then(invokeRender,function(ex){return console.log(ex)})}else{invokeRender()}}}},{"../patches/process":11,"../util/memory":15,"../util/parser":16,"../util/pools":17,"../util/render":18,"../worker/create":20,"./make":6,"./sync":9,"./tree":10}],8:[function(_dereq_,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=releaseNode;var _tree=_dereq_("./tree");var _make=_dereq_("./make");var _make2=_interopRequireDefault(_make);var _memory=_dereq_("../util/memory");var _pools=_dereq_("../util/pools");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function releaseNode(element){var elementMeta=_tree.TreeCache.get(element);if(elementMeta){if(elementMeta.worker){elementMeta.worker.terminate();delete elementMeta.worker}if(elementMeta.oldTree){(0,_memory.unprotectElement)(elementMeta.oldTree,_make2.default)}if(elementMeta.workerCache){elementMeta.workerCache.forEach(function(x){return(0,_memory.unprotectElement)(x,_make2.default)});delete elementMeta.workerCache}_tree.TreeCache.delete(element)}(0,_memory.cleanMemory)(_make2.default)}},{"../util/memory":15,"../util/pools":17,"./make":6,"./tree":10}],9:[function(_dereq_,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.CHANGE_TEXT=exports.MODIFY_ATTRIBUTE=exports.MODIFY_ELEMENT=exports.REPLACE_ENTIRE_ELEMENT=exports.REMOVE_ENTIRE_ELEMENT=exports.REMOVE_ELEMENT_CHILDREN=undefined;exports.default=sync;var _pools2=_dereq_("../util/pools");var pools=_pools2.pools;var slice=Array.prototype.slice;var filter=Array.prototype.filter;var REMOVE_ELEMENT_CHILDREN=exports.REMOVE_ELEMENT_CHILDREN=-2;var REMOVE_ENTIRE_ELEMENT=exports.REMOVE_ENTIRE_ELEMENT=-1;var REPLACE_ENTIRE_ELEMENT=exports.REPLACE_ENTIRE_ELEMENT=0;var MODIFY_ELEMENT=exports.MODIFY_ELEMENT=1;var MODIFY_ATTRIBUTE=exports.MODIFY_ATTRIBUTE=2;var CHANGE_TEXT=exports.CHANGE_TEXT=3;function sync(oldTree,newTree,patches){patches=patches||[];if(!Array.isArray(patches)){throw new Error("Missing Array to sync patches into")}if(!oldTree){throw new Error("Missing existing tree to sync")}var oldNodeValue=oldTree.nodeValue;var oldChildNodes=oldTree.childNodes;var oldChildNodesLength=oldChildNodes?oldChildNodes.length:0;var oldElement=oldTree.uuid;var oldNodeName=oldTree.nodeName;var oldIsTextNode=oldNodeName==="#text";if(!newTree){var removed=[oldTree].concat(oldChildNodes.splice(0,oldChildNodesLength));patches.push({__do__:REMOVE_ENTIRE_ELEMENT,element:oldTree,toRemove:removed});return patches}var nodeValue=newTree.nodeValue;var childNodes=newTree.childNodes;var childNodesLength=childNodes?childNodes.length:0;var newElement=newTree.uuid;var nodeName=newTree.nodeName;var newIsTextNode=nodeName==="#text";if(oldTree.nodeName!==newTree.nodeName){patches.push({__do__:REPLACE_ENTIRE_ELEMENT,old:oldTree,"new":newTree});return patches}if(oldIsTextNode&&newIsTextNode&&oldNodeValue!==nodeValue){patches.push({__do__:CHANGE_TEXT,element:oldTree,value:newTree.nodeValue});oldTree.nodeValue=newTree.nodeValue;return}if(childNodesLength>oldChildNodesLength){var fragment=[];for(var i=oldChildNodesLength;i<childNodesLength;i++){oldChildNodes.push(childNodes[i]);fragment.push(childNodes[i])}oldChildNodesLength=oldChildNodes.length;patches.push({__do__:MODIFY_ELEMENT,element:oldTree,fragment:fragment})}if(oldChildNodesLength>childNodesLength){var diff=oldChildNodesLength-childNodesLength;var toRemove=oldChildNodes.splice(oldChildNodesLength-diff,diff);oldChildNodesLength=oldChildNodes.length;if(oldChildNodesLength===0&&childNodesLength===0){patches.push({__do__:REMOVE_ELEMENT_CHILDREN,element:oldTree,toRemove:toRemove})}else{for(var i=0;i<toRemove.length;i++){patches.push({__do__:MODIFY_ELEMENT,old:toRemove[i]})}}}if(oldChildNodesLength>=childNodesLength){for(var i=0;i<childNodesLength;i++){if(oldChildNodes[i].nodeName!==childNodes[i].nodeName){patches.push({__do__:MODIFY_ELEMENT,old:oldChildNodes[i],"new":childNodes[i]});oldChildNodes[i]=childNodes[i]}else{sync(oldChildNodes[i],childNodes[i],patches)}}}var attributes=newTree.attributes;if(attributes){var oldLength=oldTree.attributes.length;var newLength=attributes.length;if(newLength>oldLength){var toAdd=slice.call(attributes,oldLength);for(var i=0;i<toAdd.length;i++){var change={__do__:MODIFY_ATTRIBUTE,element:oldTree,name:toAdd[i].name,value:toAdd[i].value};var attr=pools.attributeObject.get();attr.name=toAdd[i].name;attr.value=toAdd[i].value;pools.attributeObject.protect(attr);oldTree.attributes.push(attr);patches.push(change)}}if(oldLength>newLength){var toRemove=slice.call(oldTree.attributes,newLength);for(var i=0;i<toRemove.length;i++){var change={__do__:MODIFY_ATTRIBUTE,element:oldTree,name:toRemove[i].name,value:undefined};var removed=oldTree.attributes.splice(i,1);for(var _i=0;_i<removed.length;_i++){pools.attributeObject.unprotect(removed[_i])}patches.push(change)}}var toModify=attributes;for(var i=0;i<toModify.length;i++){var oldAttrValue=oldTree.attributes[i]&&oldTree.attributes[i].value;var newAttrValue=attributes[i]&&attributes[i].value;if(oldAttrValue!==newAttrValue){var change={__do__:MODIFY_ATTRIBUTE,element:oldTree,name:toModify[i].name,value:toModify[i].value};var attr=oldTree.attributes[i];attr.name=toModify[i].name;attr.value=toModify[i].value;patches.push(change)}}}return patches}},{"../util/pools":17}],10:[function(_dereq_,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var TreeCache=exports.TreeCache=new Map},{}],11:[function(_dereq_,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=process;var _transitions=_dereq_("../transitions");var transition=_interopRequireWildcard(_transitions);var _pools=_dereq_("../util/pools");var _get=_dereq_("../element/get");var _get2=_interopRequireDefault(_get);var _custom=_dereq_("../element/custom");var _make=_dereq_("../node/make");var _make2=_interopRequireDefault(_make);var _sync=_dereq_("../node/sync");var sync=_interopRequireWildcard(_sync);var _tree=_dereq_("../node/tree");var _memory=_dereq_("../util/memory");var _entities=_dereq_("../util/entities");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}var blockTextElements=["script","noscript","style","pre","template"];function process(element,patches){var elementMeta=_tree.TreeCache.get(element);var promises=[];var triggerTransition=transition.buildTrigger(promises);var attached=function attached(descriptor,fragment,parentNode){(0,_memory.protectElement)(descriptor);if(elementMeta.workerCache){elementMeta.workerCache.push(descriptor)}var el=(0,_get2.default)(descriptor).element;if(descriptor.nodeName==="#text"){var textPromises=transition.makePromises("textChanged",[el],null,descriptor.nodeValue);el.textContent=(0,_entities.decodeEntities)(descriptor.nodeValue);if(parentNode){var nodeName=parentNode.nodeName.toLowerCase();if(blockTextElements.indexOf(nodeName)>-1){parentNode.nodeValue=(0,_entities.decodeEntities)(descriptor.nodeValue)}}triggerTransition("textChanged",textPromises,function(promises){})}if(descriptor.attributes&&descriptor.attributes.length){descriptor.attributes.forEach(function(attr){var attrChangePromises=transition.makePromises("attributeChanged",[el],attr.name,null,attr.value);triggerTransition("attributeChanged",attrChangePromises,function(promises){})})}if(descriptor.childNodes&&descriptor.childNodes.length){descriptor.childNodes.forEach(function(x){return attached(x,null,el)})}if(fragment){fragment.appendChild(el)}return el};var _loop=function _loop(i){var patch=patches[i];var newDescriptor=undefined,oldDescriptor=undefined,elementDescriptor=undefined;var element=patch.new;if(patch.element){elementDescriptor=patch.element;var result=(0,_get2.default)(patch.element);patch.element=result.element}if(patch.old){oldDescriptor=patch.old;var result=(0,_get2.default)(patch.old);patch.old=result.element}if(patch.new){newDescriptor=patch.new;var result=(0,_get2.default)(patch.new);patch.new=result.element}if(patch.__do__===sync.REMOVE_ELEMENT_CHILDREN){var childNodes=patch.element.childNodes;var detachPromises=transition.makePromises("detached",childNodes);triggerTransition("detached",detachPromises,function(promises){patch.toRemove.forEach(function(x){return(0,_memory.unprotectElement)(x,_make2.default)});patch.element.innerHTML=""})}else if(patch.__do__===sync.REMOVE_ENTIRE_ELEMENT){var detachPromises=transition.makePromises("detached",[patch.elemnt]);if(patch.element.parentNode){triggerTransition("detached",detachPromises,function(promises){patch.element.parentNode.removeChild(patch.element);patch.toRemove.forEach(function(x){return(0,_memory.unprotectElement)(x,_make2.default)})})}else{patch.toRemove.forEach(function(x){return(0,_memory.unprotectElement)(x,_make2.default)})}}else if(patch.__do__===sync.REPLACE_ENTIRE_ELEMENT){(function(){var allPromises=[];var attachedPromises=transition.makePromises("attached",[patch.new]);var detachedPromises=transition.makePromises("detached",[patch.old]);var replacedPromises=transition.makePromises("replaced",[patch.old],patch.new);triggerTransition("detached",detachedPromises,function(promises){allPromises.push.apply(allPromises,promises)});triggerTransition("attached",attachedPromises,function(promises){allPromises.push.apply(allPromises,promises);attached(newDescriptor,null,patch.new)});triggerTransition("replaced",replacedPromises,function(promises){allPromises.push.apply(allPromises,promises)});(0,_memory.unprotectElement)(oldDescriptor,_make2.default);_tree.TreeCache.set(patch.new,{oldTree:newDescriptor,element:patch.new});if(allPromises.length){Promise.all(allPromises).then(function replaceEntireElement(){if(!patch.old.parentNode){(0,_memory.unprotectElement)(newDescriptor,_make2.default);throw new Error("Can't replace without parent, is this the "+"document root?")}patch.old.parentNode.replaceChild(patch.new,patch.old)},function(ex){return console.log(ex)})}else{if(!patch.old.parentNode){(0,_memory.unprotectElement)(newDescriptor,_make2.default);throw new Error("Can't replace without parent, is this the "+"document root?")}patch.old.parentNode.replaceChild(patch.new,patch.old)}})()}else if(patch.__do__===sync.MODIFY_ELEMENT){if(patch.element&&patch.fragment&&!patch.old){(function(){var fragment=document.createDocumentFragment();toAttach=patch.fragment.map(function(el){return attached(el,fragment,patch.element)});patch.element.appendChild(fragment);var makeAttached=transition.makePromises("attached",toAttach);triggerTransition("attached",makeAttached)})()}else if(patch.old&&!patch.new){if(!patch.old.parentNode){(0,_memory.unprotectElement)(oldDescriptor,_make2.default);throw new Error("Can't remove without parent, is this the "+"document root?")}var makeDetached=transition.makePromises("detached",[patch.old]);triggerTransition("detached",makeDetached,function(){patch.old.innerHTML="";if(patch.old.parentNode){patch.old.parentNode.removeChild(patch.old)}(0,_memory.unprotectElement)(oldDescriptor,_make2.default)})}else if(patch.old&&patch.new){(function(){if(!patch.old.parentNode){(0,_memory.unprotectElement)(oldDescriptor,_make2.default);(0,_memory.unprotectElement)(newDescriptor,_make2.default);throw new Error("Can't replace without parent, is this the "+"document root?")}if(patch.old.nextSibling){patch.old.parentNode.insertBefore(patch.new,patch.old.nextSibling)}else{patch.old.parentNode.appendChild(patch.new)}var allPromises=[];var attachPromises=transition.makePromises("attached",[patch.new]);var detachPromises=transition.makePromises("detached",[patch.old]);var replacePromises=transition.makePromises("replaced",[patch.old],patch.new);triggerTransition("detached",detachPromises,function(promises){allPromises.push.apply(allPromises,promises)});triggerTransition("attached",attachPromises,function(promises){allPromises.push.apply(allPromises,promises);attached(newDescriptor)});triggerTransition("replaced",replacePromises,function(promises){allPromises.push.apply(allPromises,promises)});if(allPromises.length){Promise.all(allPromises).then(function replaceElement(){patch.old.parentNode.replaceChild(patch.new,patch.old);(0,_memory.unprotectElement)(oldDescriptor,_make2.default);(0,_memory.protectElement)(newDescriptor);if(elementMeta.workerCache){elementMeta.workerCache.push(newDescriptor)}},function(ex){return console.log(ex)})}else{if(!patch.old.parentNode){(0,_memory.unprotectElement)(oldDescriptor,_make2.default);(0,_memory.unprotectElement)(newDescriptor,_make2.default);throw new Error("Can't replace without parent, is this the "+"document root?")}patch.old.parentNode.replaceChild(patch.new,patch.old);(0,_memory.unprotectElement)(oldDescriptor,_make2.default);(0,_memory.protectElement)(newDescriptor);if(elementMeta.workerCache){elementMeta.workerCache.push(newDescriptor)}}})()}}else if(patch.__do__===sync.MODIFY_ATTRIBUTE){var attrChangePromises=transition.makePromises("attributeChanged",[patch.element],patch.name,patch.element.getAttribute(patch.name),patch.value);triggerTransition("attributeChanged",attrChangePromises,function(promises){if(patch.value===undefined){patch.element.removeAttribute(patch.name)}else{patch.element.setAttribute(patch.name,patch.value);if(patch.name==="value"){patch.element[patch.name]=patch.value}}})}else if(patch.__do__===sync.CHANGE_TEXT){var textChangePromises=transition.makePromises("textChanged",[patch.element],patch.element.nodeValue,patch.value);triggerTransition("textChanged",textChangePromises,function(promises){elementDescriptor.nodeValue=(0,_entities.decodeEntities)(patch.value);patch.element.nodeValue=elementDescriptor.nodeValue;if(patch.element.parentNode){var nodeName=patch.element.parentNode.nodeName.toLowerCase();if(blockTextElements.indexOf(nodeName)>-1){patch.element.parentNode.nodeValue=elementDescriptor.nodeValue}}})}};for(var i=0;i<patches.length;i++){var toAttach;_loop(i)}return promises.filter(Boolean)}},{"../element/custom":1,"../element/get":2,"../node/make":6,"../node/sync":9,"../node/tree":10,"../transitions":13,"../util/entities":14,"../util/memory":15,"../util/pools":17}],12:[function(_dereq_,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var elements=exports.elements=["altGlyph","altGlyphDef","altGlyphItem","animate","animateColor","animateMotion","animateTransform","circle","clipPath","color-profile","cursor","defs","desc","ellipse","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","filter","font","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignObject","g","glyph","glyphRef","hkern","image","line","linearGradient","marker","mask","metadata","missing-glyph","mpath","path","pattern","polygon","polyline","radialGradient","rect","set","stop","svg","switch","symbol","text","textPath","tref","tspan","use","view","vkern"];

var namespace=exports.namespace="http://www.w3.org/2000/svg"},{}],13:[function(_dereq_,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.states=undefined;exports.buildTrigger=buildTrigger;exports.makePromises=makePromises;var _custom=_dereq_("./element/custom");var slice=Array.prototype.slice;var forEach=Array.prototype.forEach;var concat=Array.prototype.concat;var empty={prototype:{}};var states=exports.states={attached:[],detached:[],replaced:[],attributeChanged:[],textChanged:[]};var fnSignatures={attached:{mapFn:function mapFn(el){return function(cb){return cb(el)}},customElementsFn:function customElementsFn(el){return function(cb){return cb.call(el)}}},detached:{mapFn:function mapFn(el){return function(cb){return cb(el)}},customElementsFn:function customElementsFn(el){return function(cb){return cb.call(el)}}},replaced:{mapFn:function mapFn(oldEl,newEl){return function(cb){return cb(oldEl,newEl)}}},attributeChanged:{mapFn:function mapFn(el,name,oldVal,newVal){return function(cb){return cb(el,name,oldVal,newVal)}},customElementsFn:function customElementsFn(el,name,oldVal,newVal){return function(cb){return cb.call(el,name,oldVal,newVal)}}},textChanged:{mapFn:function mapFn(el,oldVal,newVal){return function(cb){return cb(el,oldVal,newVal)}}}};var make={};Object.keys(states).forEach(function iterateStates(stateName){var mapFn=fnSignatures[stateName].mapFn;make[stateName]=function makeTransitionPromises(elements,args,promises){forEach.call(elements,function(element){if(stateName!=="textChanged"&&element.nodeType!==1){return}var newPromises=states[stateName].map(mapFn.apply(null,[element].concat(args))).filter(Boolean);promises.push.apply(promises,newPromises);if(stateName==="attached"||stateName==="detached"){make[stateName](element.childNodes,args,promises)}});return promises}});function buildTrigger(allPromises){var addPromises=allPromises.push.apply.bind(allPromises.push,allPromises);return function(stateName,makePromisesCallback){var callback=arguments.length<=2||arguments[2]===undefined?function(x){return x}:arguments[2];if(states[stateName]&&states[stateName].length){var promises=makePromisesCallback([]);addPromises(promises);if(!promises.length){callback(promises)}else{Promise.all(promises).then(callback,function handleRejection(ex){console.log(ex)})}}else{callback()}}}function triggerLifecycleEvent(stateName,args,elements){var customElementFn=fnSignatures[stateName].customElementsFn;for(var i=0;i<elements.length;i++){var element=elements[i];if(element){var customElement=_custom.components[element.nodeName.toLowerCase()]||empty;var customElementMethodName=stateName+"Callback";if(customElement.prototype[customElementMethodName]){customElementFn.apply(null,args)(customElement.prototype[customElementMethodName].bind(element))}}}}function makePromises(stateName){for(var _len=arguments.length,args=Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){args[_key-1]=arguments[_key]}var elements=slice.call(args[0]);triggerLifecycleEvent(stateName,args.slice(1),elements);return function(promises){return make[stateName](elements,args.slice(1),promises)}}},{"./element/custom":1}],14:[function(_dereq_,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.decodeEntities=decodeEntities;var element=document.createElement("div");function decodeEntities(string){element.innerHTML=string;return element.textContent}},{}],15:[function(_dereq_,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.protectElement=protectElement;exports.unprotectElement=unprotectElement;exports.cleanMemory=cleanMemory;var _pools2=_dereq_("../util/pools");var _make=_dereq_("../node/make");var _make2=_interopRequireDefault(_make);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}var pools=_pools2.pools;var makeNode=_make2.default;var elementObject=pools.elementObject;var attributeObject=pools.attributeObject;function protectElement(element){pools.elementObject.protect(element);element.attributes.forEach(pools.attributeObject.protect,pools.attributeObject);if(element.childNodes){element.childNodes.forEach(protectElement)}return element}function unprotectElement(element,makeNode){elementObject.unprotect(element);elementObject.cache.uuid.delete(element.uuid);element.attributes.forEach(attributeObject.unprotect,attributeObject);if(element.childNodes){element.childNodes.forEach(function(node){return unprotectElement(node,makeNode)})}if(makeNode&&makeNode.nodes){delete makeNode.nodes[element.uuid]}return element}function cleanMemory(makeNode){if(makeNode&&makeNode.nodes){for(var uuid in makeNode.nodes){if(!elementObject.cache.uuid.has(uuid)){delete makeNode.nodes[uuid]}}}elementObject.cache.allocated.forEach(function(v){return elementObject.cache.free.push(v)});elementObject.cache.allocated.clear()}},{"../node/make":6,"../util/pools":17}],16:[function(_dereq_,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.parseHTML=parseHTML;exports.makeParser=makeParser;var _pools2=_dereq_("./pools");var pools=_pools2.pools;var parser=makeParser();var slice=Array.prototype.slice;function parseHTML(newHTML,isInner){var documentElement=parser.parse(newHTML);var nodes=documentElement.childNodes;return isInner?nodes:nodes[0]}function makeParser(){var kMarkupPattern=/<!--[^]*?(?=-->)-->|<(\/?)([a-z\-][a-z0-9\-]*)\s*([^>]*?)(\/?)>/gi;var kAttributePattern=/\b(id|class)\s*(=\s*("([^"]+)"|'([^']+)'|(\S+)))?/gi;var reAttrPattern=/\b([a-z][a-z0-9\-]*)\s*(=\s*("([^"]+)"|'([^']+)'|(\S+)))?/gi;var kSelfClosingElements={meta:true,img:true,link:true,input:true,area:true,br:true,hr:true};var kElementsClosedByOpening={li:{li:true},p:{p:true,div:true},td:{td:true,th:true},th:{td:true,th:true}};var kElementsClosedByClosing={li:{ul:true,ol:true},a:{div:true},b:{div:true},i:{div:true},p:{div:true},td:{tr:true,table:true},th:{tr:true,table:true}};var kBlockTextElements={script:true,noscript:true,style:true,template:true};var escapeMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"};function TextNode(value){var instance=pools.elementObject.get();instance.nodeName="#text";instance.nodeValue=value;instance.nodeType=3;instance.childNodes.length=0;instance.attributes.length=0;return instance}function HTMLElement(name,keyAttrs,rawAttrs){var instance=pools.elementObject.get();instance.nodeName=name;instance.nodeValue="";instance.nodeType=1;instance.childNodes.length=0;instance.attributes.length=0;if(rawAttrs){for(var match;match=reAttrPattern.exec(rawAttrs);){var attr=pools.attributeObject.get();attr.name=match[1];attr.value=match[6]||match[5]||match[4]||match[1];if(match[6]==='""'){attr.value=""}instance.attributes[instance.attributes.length]=attr}}return instance}var htmlParser={parse:function parse(data){var rootObject={};var root=HTMLElement(null,rootObject);var currentParent=root;var stack=[root];var lastTextPos=-1;if(data.indexOf("<")===-1&&data){currentParent.childNodes[currentParent.childNodes.length]=TextNode(data);return root}for(var match,text;match=kMarkupPattern.exec(data);){if(lastTextPos>-1){if(lastTextPos+match[0].length<kMarkupPattern.lastIndex){text=data.slice(lastTextPos,kMarkupPattern.lastIndex-match[0].length);currentParent.childNodes.push(TextNode(text))}}lastTextPos=kMarkupPattern.lastIndex;if(match[0][1]==="!"){continue}if(!match[1]){var attrs={};for(var attMatch;attMatch=kAttributePattern.exec(match[3]);){attrs[attMatch[1]]=attMatch[3]||attMatch[4]||attMatch[5]}if(!match[4]&&kElementsClosedByOpening[currentParent.nodeName]){if(kElementsClosedByOpening[currentParent.nodeName][match[2]]){stack.pop();currentParent=stack[stack.length-1]}}currentParent=currentParent.childNodes[currentParent.childNodes.push(HTMLElement(match[2],attrs,match[3]))-1];stack.push(currentParent);if(kBlockTextElements[match[2]]){var closeMarkup="</"+match[2]+">";var index=data.indexOf(closeMarkup,kMarkupPattern.lastIndex);var length=match[2].length;if(index===-1){lastTextPos=kMarkupPattern.lastIndex=data.length+1}else{lastTextPos=kMarkupPattern.lastIndex=index+closeMarkup.length;match[1]=true}var newText=data.slice(match.index+match[0].length,index);if(newText.trim()){newText=slice.call(newText).map(function(ch){return escapeMap[ch]||ch}).join("");currentParent.childNodes.push(TextNode(newText))}}}if(match[1]||match[4]||kSelfClosingElements[match[2]]){while(currentParent){if(currentParent.nodeName==match[2]){stack.pop();currentParent=stack[stack.length-1];break}else{if(kElementsClosedByClosing[currentParent.nodeName]){if(kElementsClosedByClosing[currentParent.nodeName][match[2]]){stack.pop();currentParent=stack[stack.length-1];continue}}break}}}}if(root.childNodes.length&&root.childNodes[0].nodeName==="html"){(function(){var head={before:[],after:[]};var body={after:[]};var beforeHead=true;var beforeBody=true;var HTML=root.childNodes[0];HTML.childNodes=HTML.childNodes.filter(function(el){if(el.nodeName==="body"||el.nodeName==="head"){if(el.nodeName==="head"){beforeHead=false}if(el.nodeName==="body"){beforeBody=false}return true}else if(el.nodeType===1){if(beforeHead&&beforeBody){head.before.push(el)}else if(!beforeHead&&beforeBody){head.after.push(el)}else if(!beforeBody){body.after.push(el)}}});if(!HTML.childNodes[0]||HTML.childNodes[0].nodeName!=="head"){var headInstance=pools.elementObject.get();headInstance.nodeName="head";headInstance.childNodes.length=0;headInstance.attributes.length=0;var existing=headInstance.childNodes;existing.unshift.apply(existing,head.before);existing.push.apply(existing,head.after);HTML.childNodes.unshift(headInstance)}else{var existing=HTML.childNodes[0].childNodes;existing.unshift.apply(existing,head.before);existing.push.apply(existing,head.after)}if(!HTML.childNodes[1]||HTML.childNodes[1].nodeName!=="body"){var bodyInstance=pools.elementObject.get();bodyInstance.nodeName="body";bodyInstance.childNodes.length=0;bodyInstance.attributes.length=0;var existing=bodyInstance.childNodes;existing.push.apply(existing,body.after);HTML.childNodes.push(bodyInstance)}else{var existing=HTML.childNodes[1].childNodes;existing.push.apply(existing,body.after)}})()}return root}};return htmlParser}},{"./pools":17}],17:[function(_dereq_,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.count=exports.pools=undefined;exports.createPool=createPool;exports.initializePools=initializePools;var _uuid2=_dereq_("./uuid");var _uuid3=_interopRequireDefault(_uuid2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}var uuid=_uuid3.default;var pools=exports.pools={};var count=exports.count=1e4;function createPool(name,opts){var size=opts.size;var fill=opts.fill;var cache={free:[],allocated:new Set,"protected":new Set,uuid:new Set};for(var i=0;i<size;i++){cache.free.push(fill())}return{cache:cache,get:function get(){var value=cache.free.pop()||fill();cache.allocated.add(value);return value},protect:function protect(value){cache.allocated.delete(value);cache.protected.add(value);if(name==="elementObject"){cache.uuid.add(value.uuid)}},unprotect:function unprotect(value){if(cache.protected.has(value)){cache.protected.delete(value);cache.free.push(value)}}}}function initializePools(COUNT){pools.attributeObject=createPool("attributeObject",{size:COUNT,fill:function fill(){return{name:"",value:""}}});pools.elementObject=createPool("elementObject",{size:COUNT,fill:function fill(){return{uuid:uuid(),childNodes:[],attributes:[]}}})}initializePools(count)},{"./uuid":19}],18:[function(_dereq_,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.completeRender=completeRender;var _customEvent=_dereq_("custom-event");var _customEvent2=_interopRequireDefault(_customEvent);var _patch=_dereq_("../node/patch");var _patch2=_interopRequireDefault(_patch);var _make=_dereq_("../node/make");var _make2=_interopRequireDefault(_make);var _tree=_dereq_("../node/tree");var _memory=_dereq_("../util/memory");var _pools=_dereq_("../util/pools");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function renderNext(elementMeta){var nextRender=elementMeta.renderBuffer;elementMeta.renderBuffer=undefined;(0,_patch2.default)(nextRender.element,nextRender.newHTML,nextRender.options)}function completeRender(element,elementMeta){return function invokeRender(){elementMeta.previousMarkup=elementMeta.options.inner?element.innerHTML:element.outerHTML;elementMeta._textContent=element.textContent;(0,_memory.cleanMemory)(_make2.default);elementMeta.isRendering=false;var stopLooping=false;if(elementMeta.renderBuffer){renderNext(elementMeta)}else{_tree.TreeCache.forEach(function iterateTreeCache(elementMeta){if(!stopLooping&&elementMeta.renderBuffer){renderNext(elementMeta);stopLooping=true}})}element.dispatchEvent(new _customEvent2.default("renderComplete"))}}},{"../node/make":6,"../node/patch":7,"../node/tree":10,"../util/memory":15,"../util/pools":17,"custom-event":22}],19:[function(_dereq_,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=uuid;function uuid(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=Math.random()*16|0;var v=c=="x"?r:r&3|8;return v.toString(16)})}},{}],20:[function(_dereq_,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.hasWorker=undefined;exports.create=create;var _uuid=_dereq_("../util/uuid");var _uuid2=_interopRequireDefault(_uuid);var _pools=_dereq_("../util/pools");var _parser=_dereq_("../util/parser");var _memory=_dereq_("../util/memory");var _sync=_dereq_("../node/sync");var _sync2=_interopRequireDefault(_sync);var _make=_dereq_("../node/make");var _make2=_interopRequireDefault(_make);var _source=_dereq_("./source");var _source2=_interopRequireDefault(_source);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}var hasWorker=exports.hasWorker=typeof Worker==="function";var COV_EXP=/__cov_([^\+\+]*)\+\+/gi;function filterOutCoverage(string){return string.replace(COV_EXP,"null")}function create(){var worker=null;var workerBlob=null;var workerSource=filterOutCoverage("\n    // Reusable Array methods.\n    var slice = Array.prototype.slice;\n    var filter = Array.prototype.filter;\n\n    // Add a namespace to attach pool methods to.\n    var pools = {};\n    var nodes = 0;\n    var REMOVE_ELEMENT_CHILDREN = -2;\n    var REMOVE_ENTIRE_ELEMENT = -1;\n    var MODIFY_ELEMENT = 1;\n    var MODIFY_ATTRIBUTE = 2;\n    var CHANGE_TEXT = 3;\n\n    "+_uuid2.default+";\n\n    // Add the ability to protect elements from free'd memory.\n    "+_memory.protectElement+";\n    "+_memory.unprotectElement+";\n    "+_memory.cleanMemory+";\n\n    // Add in pool manipulation methods.\n    "+_pools.createPool+";\n    "+_pools.initializePools+";\n\n    initializePools("+_pools.count+");\n\n    // Add in Node manipulation.\n    var syncNode = "+_sync2.default+";\n    var makeNode = "+_make2.default+";\n\n    // Add in the ability to parseHTML.\n    "+_parser.parseHTML+";\n\n    var makeParser = "+_parser.makeParser+";\n    var parser = makeParser();\n\n    // Add in the worker source.\n    "+_source2.default+";\n\n    // Metaprogramming up this worker call.\n    startup(self);\n  ");if(hasWorker){workerBlob=new Blob([workerSource],{type:"application/javascript"});try{worker=new Worker(URL.createObjectURL(workerBlob))}catch(ex){if(console&&console.info){console.info("Failed to create diffhtml worker",ex)}exports.hasWorker=hasWorker=false}}return worker}},{"../node/make":6,"../node/sync":9,"../util/memory":15,"../util/parser":16,"../util/pools":17,"../util/uuid":19,"./source":21}],21:[function(_dereq_,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=startup;var parseHTML;var syncNode;var pools;var unprotectElement;var protectElement;var cleanMemory;function startup(worker){var patches=[];var oldTree=null;worker.onmessage=function onmessage(e){var data=e.data;var isInner=data.isInner;var newTree=null;if(data.oldTree){if(oldTree){unprotectElement(oldTree);cleanMemory()}oldTree=data.oldTree}if(data.newTree){newTree=data.newTree}else if(typeof data.newHTML==="string"){newTree=parseHTML(data.newHTML,isInner);if(isInner){var childNodes=newTree;newTree={childNodes:childNodes,attributes:oldTree.attributes,uuid:oldTree.uuid,nodeName:oldTree.nodeName,nodeValue:oldTree.nodeValue}}}syncNode(oldTree,newTree,patches);protectElement(oldTree);worker.postMessage({patches:patches});cleanMemory();patches.length=0}}},{}],22:[function(_dereq_,module,exports){(function(global){var NativeCustomEvent=global.CustomEvent;function useNative(){try{var p=new NativeCustomEvent("cat",{detail:{foo:"bar"}});return"cat"===p.type&&"bar"===p.detail.foo}catch(e){}return false}module.exports=useNative()?NativeCustomEvent:"function"===typeof document.createEvent?function CustomEvent(type,params){var e=document.createEvent("CustomEvent");if(params){e.initCustomEvent(type,params.bubbles,params.cancelable,params.detail)}else{e.initCustomEvent(type,false,false,void 0)}return e}:function CustomEvent(type,params){var e=document.createEventObject();e.type=type;if(params){e.bubbles=Boolean(params.bubbles);e.cancelable=Boolean(params.cancelable);e.detail=params.detail}else{e.bubbles=false;e.cancelable=false;e.detail=void 0}return e}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}]},{},[5])(5)});